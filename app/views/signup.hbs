
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <title>Authentication</title>
</head>
<body>
  <div class="container">
    <div class="jumbotron text-center">
        <h1><span class="fa fa-lock"></span> Node Authentication</h1>
    </div>
    <div class="row">
      <div class="col-md-6">
        <form id="signup" name="signup" method="post" action="/signup">
          <div class="row">
            <h2>Sign Up</h2>
          </div>
          <div class="row">
            <label for="email">Email Address</label>
            <input class="text" name="email" type="email" />
          </div>
          <div class="row">
            <label for="password">Password</label>
            <input name="password" type="password" />
          </div>
          <div class="row">
            <input class="btn" type="submit" value="Sign Up" />
          </div>
        </form>
      </div>
      <div class="col-md-6">
        <form id="signin">
          <div class="row">
            <h2>Sign In</h2>
          </div>
          <div class="row">
            <label for="email">Email Address</label>
            <input class="text" name="email" type="text" />
          </div>
          <div class="row">
            <label for="password">Password</label>
            <input name="password" type="password" />
          </div>
          <div class="row">
            <input id="signinButton" class="btn" type="submit" value="Sign In" />
          </div>
        </form>
      </div>
    </div>

    <script>
      $( "#signinButton" ).on("click", function() {
        console.log('heeeeree')

          event.preventDefault();
          // debugger
          var email = $("#signin").serializeArray()[0].value;
          var password = $("#signin").serializeArray()[1].value;
          var data = {email: email, password: password};
          var url = 'http://localhost:5000/signin';

          $.ajax({
              type: "POST",
              url: url,
              data: data
          }).done(function( data, textStatus, request) {
              window.localStorage.setItem("token", data.token);
              document.cookie = `shane_token=${data.token}`;
              window.open(`/dashboard/${data.user}`, '_self', false);
              // launchDashboard(data.user)
          });
      });


      function launchDashboard(user) {
        console.log('launch dashboard')
          var url = `http://localhost:5000/dashboard/${user}`;
          var token = window.localStorage.getItem("token");
          var authHeader = { token: token };
          $.ajax({
              type: "GET",
              url: url,
              dataType: "json",
              contentType: "application/json",
              headers: {'Authorization': JSON.stringify(authHeader)}
          }).done(function(data){
            console.log('what?')
          })
      }

    </script>
    
<!--         <a href="/login" class="btn btn-default"><span class="fa fa-user"></span> Local Login</a>
        <a href="/signup" class="btn btn-default"><span class="fa fa-user"></span> Local Signup</a>

  </div>
<form id="signup" name="signup" method="post" action="/signup">
  <label for="email">Email Address</label>
  <input class="text" name="email" type="email" />
  <label for="firstname">Firstname</label>
  <input name="firstname" type="text" />
  <label for="lastname">Lastname</label>
  <input name="lastname" type="text" />
  <label for="password">Password</label>
  <input name="password" type="password" />
  <input class="btn" type="submit" value="Sign Up" />
</form> -->

</body>
</html>